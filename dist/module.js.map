{"mappings":"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","sources":["stamen/mapbox-gl-style-linter/src/index.js","stamen/mapbox-gl-style-linter/src/lib/lint.js","stamen/mapbox-gl-style-linter/src/lib/formatted-style-spec-validate.js","stamen/mapbox-gl-style-linter/src/lib/lint-layer.js"],"sourcesContent":["import lint from \"./lib/lint\";\n\nexport { lint };\n","import { formattedStyleSpecValidate } from './formatted-style-spec-validate';\nimport { validateLayers } from './lint-layer.js';\n\nexport default style => {\n  return [...formattedStyleSpecValidate(style), ...validateLayers(style)];\n};\n","import { validate } from '@mapbox/mapbox-gl-style-spec';\n\nconst formattedStyleSpecValidate = style => {\n  const { layers } = style;\n  const validationErrors = validate(style);\n  const formattedErrors = validationErrors.map(e => {\n    const { message } = e;\n    const matches = message.match(/layers\\[\\d+\\]/g);\n    if (!matches) return e;\n    let nextMessage = message;\n    matches.forEach(match => {\n      const layerIndex = JSON.parse(match.replace('layers', ''));\n      const layer = layers[layerIndex];\n      nextMessage = nextMessage.split(match).join(`layer '${layer.id}'`);\n    });\n    return { ...e, message: nextMessage };\n  });\n\n  return formattedErrors;\n};\n\nexport { formattedStyleSpecValidate };\n","import { latest, ValidationError } from '@mapbox/mapbox-gl-style-spec';\n\n/**\n * getPropertyIds\n * Get property ids for either `paint` or `layout` properties\n * @param {string} type - `paint` or `layout`\n * @returns {string[]} - property ids for the given type\n */\nconst getPropertyIds = type => {\n  let propertyIds = latest[type]\n    .map(layerType => Object.keys(latest[layerType]))\n    .flat(1);\n  return Array.from(new Set(propertyIds));\n};\n\nconst paintProperties = getPropertyIds('paint');\nconst layoutProperties = getPropertyIds('layout');\n\n/**\n * validateMisplacedProperties\n * Find property ids at the top level of a layer that should not be there\n * @param {Object} layer - a layer object from a style\n * @param {string[]} ids - property ids to look for\n * @param {string} type - `paint` or `layout`\n * @returns {ValidationError[]} - an error for each id found, if any\n */\nconst validateMisplacedProperties = (layer, ids, type) => {\n  return Object.keys(layer)\n    .filter(key => ids.includes(key))\n    .map(key => new ValidationError(key, layer[key], `layer '${layer.id}' contains '${key}' at the top level, but it should be in ${type}`));\n}\n\nconst validateMisplacedPaintProperties = layer => {\n  return validateMisplacedProperties(layer, paintProperties, 'paint');\n};\n\nconst validateMisplacedLayoutProperties = layer => {\n  return validateMisplacedProperties(layer, layoutProperties, 'layout');\n};\n\nexport const validateLayer = layer => {\n  return [\n    ...validateMisplacedLayoutProperties(layer),\n    ...validateMisplacedPaintProperties(layer),\n  ];\n};\n\nexport const validateLayers = style => {\n  if (!style.layers) return [];\n  return style.layers.map(validateLayer).flat(Infinity);\n};\n"],"names":[],"version":3,"file":"module.js.map"}